# 変更履歴：レビューページ・閉じる確認・タイマー連動（2025年2月12日）

今回実施した修正・機能変更のまとめです。

---

## 1. Word アプリ終了確認メッセージが透明で読めない問題の修正

**現象**  
アプリバーの「閉じる」押下時に表示する「アプリ自体を終了します。本当にいいですか？」の MessageBox の文字が透明で読めなかった。

**原因**  
UiTestAppBarWindow / AppBarWindow が `AllowsTransparency="True"` のため、そのウィンドウが MessageBox のオーナーになると、描画の関係で文字が透明になることがある。

**対応**  
- **UiTestAppBarWindow.xaml.cs** の `CloseButton_Click`  
  - `MessageBox.Show(...)` の第1引数に `Application.Current.MainWindow` を指定（オーナー付きオーバーロードを使用）。  
  - `MainWindow` が null のときは従来どおりオーナーなしで表示。
- **AppBarWindow.xaml.cs** の `CloseButton_Click`  
  - 上記と同様にオーナーに `Application.Current.MainWindow` を指定。

**対象**  
- `MOS Word app\Views\UiTestAppBarWindow.xaml.cs`
- `MOS Word app\Views\AppBarWindow.xaml.cs`

---

## 2. 全アプリのレビューページで「閉じる」系ボタンを非表示にし「結果の表示」のみ表示

**要件**  
レビューページではアプリを落とすための「閉じる」系ボタンを非表示にし、「結果の表示」ボタンのみ表示する。

### 2.1 Excel（mos_xaml_app）

- **ReviewPageWindow.xaml**
  - ヘッダー「✕」ボタン: `Visibility="Collapsed"`
  - フッター「終了」ボタン: `Visibility="Collapsed"`
  - 「試験終了」ボタンの表示文言を「**結果の表示**」に変更（クリック処理は従来どおり `EndExamButton_Click`）

### 2.2 Word（MOS Word app）

- **ReviewPageWindow.xaml**
  - ヘッダー「✕」ボタン: `Visibility="Collapsed"`
  - フッターの「閉じる」ボタン: **XAML から削除**（要素ごと削除して確実に非表示）
  - 「試験終了」ボタンの表示文言を「**結果の表示**」に変更（クリック処理は従来どおり `EndExamButton_Click`）

### 2.3 PowerPoint（Mos PowerPoint Mogi App）

- **ReviewPageWindow.xaml**
  - フッター「戻る」ボタン: `Visibility="Collapsed"`
  - 「結果の表示」ボタンはそのまま表示（文言・処理とも変更なし）

**対象ファイル**  
- `mos_xaml_app\Views\ReviewPageWindow.xaml`
- `MOS Word app\Views\ReviewPageWindow.xaml`
- `Mos PowerPoint Mogi App\Views\ReviewPageWindow.xaml`

---

## 3. Word のレビューページに「閉じる」が残っていた問題の追加対応

**現象**  
Word のレビューページで「結果の表示」の右側に「閉じる」ボタンがまだ表示されていた。

**対応**  
`Visibility="Collapsed"` では表示される環境があったため、**フッターの「閉じる」ボタン要素を XAML から完全に削除**。  
「結果の表示」ボタンのみがフッターに残るようにした。

**対象**  
- `MOS Word app\Views\ReviewPageWindow.xaml`

---

## 4. Word のレビューページで PowerPoint の問題一覧が表示されていた問題の修正

**現象**  
Word アプリのレビューページを開くと、PowerPoint 用の問題文（スライド関連タスク）が表示されていた。

**原因**  
Word の `ReviewPageWindow.xaml.cs` で、問題一覧の読み込みに **PowerPoint 用 JSON**（`MOS模擬アプリ問題文一覧_PowerPoint.json`）を指定していた。

**対応**  
- 読み込み JSON を **Word 用** に変更:  
  `MOS模擬アプリ問題文一覧_PowerPoint.json`  
  → **`MOS模擬アプリ問題文一覧_Word.json`**
- クラスコメントを「PowerPointアプリ用」→「**Wordアプリ用**」に修正。

**対象**  
- `MOS Word app\Views\ReviewPageWindow.xaml.cs`

---

## 5. 全アプリでレビューページのタイマーを「タイマーを使用」に連動

**要件**  
プロジェクト一覧で「タイマーを使用」にチェックしていない場合は、レビューページに移動してもタイマーは止まったままにする。

**対応（3アプリ共通）**  
各アプリの `ReviewPageWindow.xaml.cs` で以下を実施。

- **InitializeTimer**
  - `MainWindow.IsTimerDisabled` が **false** のときだけ `_timer.Start()` を実行。  
  - チェックなし（タイマー無効）のときはタイマーを開始しない。
- **Timer_Tick**
  - 先頭で `if (MainWindow.IsTimerDisabled) return;` を追加。  
  - 無効時はカウントダウンしない（表示はそのまま）。

**参照する静的プロパティ**  
- Excel: `MainWindow.IsTimerDisabled`（namespace: MOSExcelMogiApp）
- Word: `MOS_Word_app.MainWindow.IsTimerDisabled`
- PowerPoint: `MOS_PowerPoint_app.MainWindow.IsTimerDisabled`

**対象ファイル**  
- `mos_xaml_app\Views\ReviewPageWindow.xaml.cs`
- `MOS Word app\Views\ReviewPageWindow.xaml.cs`
- `Mos PowerPoint Mogi App\Views\ReviewPageWindow.xaml.cs`

---

## 変更ファイル一覧

| アプリ | ファイル |
|--------|----------|
| Word | `MOS Word app\Views\UiTestAppBarWindow.xaml.cs` |
| Word | `MOS Word app\Views\AppBarWindow.xaml.cs` |
| Word | `MOS Word app\Views\ReviewPageWindow.xaml` |
| Word | `MOS Word app\Views\ReviewPageWindow.xaml.cs` |
| Excel | `mos_xaml_app\Views\ReviewPageWindow.xaml` |
| Excel | `mos_xaml_app\Views\ReviewPageWindow.xaml.cs` |
| PowerPoint | `Mos PowerPoint Mogi App\Views\ReviewPageWindow.xaml` |
| PowerPoint | `Mos PowerPoint Mogi App\Views\ReviewPageWindow.xaml.cs` |

以上。
